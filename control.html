<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Alarmanlage Steuerung</title>
</head>
<body>
  <h1>Alarmanlage Steuerung</h1>

  <button id="updateBtn">Status und AE updaten</button>

  <script>
    const supabaseUrl = "https://rshbpsxqbabpxhdztozz.supabase.co/rest/v1/anlage_status";
    const supabaseApiKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJzaGJwc3hxYmFicHhoZHp0b3p6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAzNjYyMDgsImV4cCI6MjA2NTk0MjIwOH0.4MG6d3QkPv7hj7PcCacZgXp-8YRD_2ANHd7bvFzxtX4";

    // Deine User-ID für Filter (korrekt einsetzen)
    const userId = "ae3e82b9-eedf-49d8-afdc-afcbc9da9669";

    async function updateStatus(newStatus, newAe) {
      try {
        const url = `${supabaseUrl}?user_id=eq.${userId}`;
        
        const response = await fetch(url, {
          method: 'PATCH',
          headers: {
            'apikey': supabaseApiKey,
            'Authorization': `Bearer ${supabaseApiKey}`,
            'Content-Type': 'application/json',
            'Prefer': 'return=representation'  // damit gibt Supabase geänderte Daten zurück
          },
          body: JSON.stringify({
            status: newStatus,
            ae: newAe
          })
        });

        if (!response.ok) {
          const errorText = await response.text();
          console.error('Fehler beim Aktualisieren:', response.status, errorText);
          alert("Update fehlgeschlagen: " + response.status);
          return;
        }

        const data = await response.json();
        console.log('Update erfolgreich:', data);
        alert("Update erfolgreich: " + JSON.stringify(data));
      } catch (error) {
        console.error('Update Fehler:', error);
        alert("Fehler beim Update: " + error.message);
      }
    }

    // Beispiel-Button, um Update auszulösen
    document.getElementById("updateBtn").addEventListener("click", () => {
      // Hier Status und AE eintragen (kannst du durch UI ersetzen)
      updateStatus("scharf", 300);
    });
  </script>
</body>
</html>
