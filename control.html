import { createClient } from '@supabase/supabase-js';

// Supabase-Konfiguration
const supabaseUrl = 'https://rshbpsxqbabpxhdztozz.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJzaGJwc3hxYmFicHhoZHp0b3p6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAzNjYyMDgsImV4cCI6MjA2NTk0MjIwOH0.4MG6d3QkPv7hj7PcCacZgXp-8YRD_2ANHd7bvFzxtX4';
const supabase = createClient(supabaseUrl, supabaseKey);

// Benutzer-ID
const userId = 'ae3e82b9-eedf-49d8-afdc-afcbc9da9669';

// Status und AE-Wert abrufen
async function fetchStatus() {
  const { data, error } = await supabase
    .from('anlage_status')
    .select('status, ae')
    .eq('user_id', userId)
    .single();

  if (error) {
    console.error('Fehler beim Abrufen:', error);
    return;
  }

  console.log('Status:', data.status);
  console.log('AE:', data.ae);

  // UI aktualisieren
  document.getElementById('statusAnzeige').innerText = `Status: ${data.status}`;
  document.getElementById('aeAnzeige').innerText = `AE-Wert: ${data.ae}`;
  document.getElementById('aeInput').value = data.ae;
  document.getElementById('statusSelect').value = data.status;
}

// Status und AE-Wert aktualisieren
async function updateStatus() {
  const newStatus = document.getElementById('statusSelect').value;
  const newAe = parseInt(document.getElementById('aeInput').value, 10);

  const { error } = await supabase
    .from('anlage_status')
    .update({ status: newStatus, ae: newAe })
    .eq('user_id', userId);

  if (error) {
    console.error('Fehler beim Aktualisieren:', error);
  } else {
    console.log('Update erfolgreich');
    fetchStatus(); // Direkt neu laden
  }
}

// Automatisch alle 5 Sekunden aktualisieren
setInterval(fetchStatus, 5000);

// Erstes Laden
fetchStatus();

// Event Listener f√ºr Button
document.getElementById('updateButton').addEventListener('click', updateStatus);
