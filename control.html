import { createClient } from '@supabase/supabase-js';

// Supabase Setup
const supabaseUrl = 'https://rshbpsxqbabpxhdztozz.supabase.co';
const supabaseKey =
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJzaGJwc3hxYmFicHhoZHp0b3p6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAzNjYyMDgsImV4cCI6MjA2NTk0MjIwOH0.4MG6d3QkPv7hj7PcCacZgXp-8YRD_2ANHd7bvFzxtX4';
const supabase = createClient(supabaseUrl, supabaseKey);
const userId = 'ae3e82b9-eedf-49d8-afdc-afcbc9da9669';

let currentStatus = 'aus';
let currentAe = 300;

// Aktuelle Werte abrufen und anzeigen
async function fetchStatus() {
  const { data, error } = await supabase
    .from('anlage_status')
    .select('status, ae')
    .eq('user_id', userId)
    .single();

  if (error || !data) {
    console.error('Abruffehler:', error);
    return;
  }

  currentStatus = data.status;
  currentAe = data.ae;

  document.getElementById('statusAnzeige').textContent = data.status;
  document.getElementById('aeAnzeige').textContent = data.ae;
}

// Neuen Status und AE-Wert speichern
async function updateStatus() {
  const { error } = await supabase
    .from('anlage_status')
    .update({ status: currentStatus, ae: currentAe })
    .eq('user_id', userId);

  if (error) {
    console.error('Updatefehler:', error);
  } else {
    fetchStatus(); // Anzeige aktualisieren
  }
}

// Event-Handler für Buttons
document.getElementById('btnAus').addEventListener('click', () => {
  currentStatus = 'aus';
  updateStatus();
});

document.getElementById('btnEntschaerft').addEventListener('click', () => {
  currentStatus = 'entschärft';
  updateStatus();
});

document.getElementById('btnScharf').addEventListener('click', () => {
  currentStatus = 'scharf';
  updateStatus();
});

document.getElementById('btnAeMinus').addEventListener('click', () => {
  if (currentAe > 0) currentAe -= 10;
  updateStatus();
});

document.getElementById('btnAePlus').addEventListener('click', () => {
  if (currentAe < 1023) currentAe += 10;
  updateStatus();
});

// Regelmäßige Aktualisierung der Anzeige
setInterval(fetchStatus, 5000);
fetchStatus();
